<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tampunganglawo</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.8.1/font/bootstrap-icons.min.css"
    />

    <!-- JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>

    <!-- CSS -->
    <style>
      html {
        scroll-behavior: smooth;
      }
      /* Make sure dropdowns appear above other content */
      .notification-dropdown,
      .cart-dropdown,
      .dropdown-menu {
        position: absolute;
        z-index: 1050; /* Ensure it's above other elements */
        display: none; /* Initially hidden */
      }

      /* Show dropdown when 'show' class is added */
      .show {
        display: block;
      }

      .navbar {
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        z-index: 1000;
        padding: 0.5rem 1rem;
      }
      .navbar-logo {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        object-fit: cover;
      }
      .navbar-brand {
        margin-left: 2rem;
        margin-right: 2rem;
      }
      .navbar-nav {
        margin: 0 auto;
      }
      .nav-item {
        margin-left: 1rem;
      }
      .nav-link {
        font-size: 1.25rem;
        padding: 0.75rem 1rem;
        transition: background-color 0.3s;
      }
      .nav-link:hover {
        background-color: #4dcaff;
        border-radius: 0.25rem;
      }
      .navbar-nav.ms-auto {
        margin-right: 2rem;
      }
      .nav-item .nav-link {
        font-size: 1.5rem;
      }
      .navbar-nav .nav-item .nav-link {
        margin-left: 1rem;
      }
      .dropdown-menu {
        min-width: 200px;
        font-size: 1.25rem;
      }
      .dropdown-item {
        padding: 0.75rem 1.5rem;
      }
      .bi {
        font-size: 2rem;
      }
      .notification-dropdown,
      .cart-dropdown {
        display: none;
        position: absolute;
        top: 100%;
        right: 0;
        background: white;
        border: 1px solid #ddd;
        border-radius: 0.5rem;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        z-index: 1000;
      }
      .notification-dropdown.show,
      .cart-dropdown.show {
        display: block;
      }

      .cart-dropdown {
        max-height: 400px;
        overflow-y: auto;
        width: 350px;
      }

      .cart-item {
        display: flex;
        align-items: center;
        padding: 10px 0;
      }

      .cart-item-image {
        width: 50px;
        height: 50px;
        object-fit: cover;
        border-radius: 5px;
      }

      .cart-item-details {
        flex-grow: 1;
      }

      .cart-item-name {
        margin: 0;
        font-size: 14px;
      }

      .cart-item-quantity,
      .cart-item-price {
        margin: 0;
        font-size: 12px;
      }

      .remove-item {
        border: none;
        background: none;
        cursor: pointer;
        color: #dc3545;
      }

      .remove-item:hover {
        color: #c82333;
      }

      .dropdown-menu {
        padding: 0;
      }

      hr {
        margin: 0;
      }

      /* Hero Section */
      .hero {
        min-height: 100vh;
        display: flex;
        align-items: center;
        background-image: url("../static/img/123.jpeg");
        background-repeat: no-repeat;
        background-size: cover;
        background-position: center;
        position: relative;
        -webkit-mask-image: linear-gradient(
          rgba(0, 0, 0, 1) 85%,
          rgba(0, 0, 0, 0)
        );
        mask-image: linear-gradient(rgba(0, 0, 0, 1) 85%, rgba(0, 0, 0, 0));
      }

      /* .hero::after {
        content: '';
        display: block;
        position: absolute;
        width: 100%;
        height: 30%;
        bottom: 0;
        background: linear-gradient(0deg, rgba(1, 1, 3, 1) 8%, rgba(255, 255, 255, 0) 50%);
      } */

      .hero .mask-container {
        position: absolute;
        /* background: salmon; */
        inset: 0;
        -webkit-mask-image: url("../static/img/123.svg");
        -webkit-mask-repeat: no-repeat;
        -webkit-mask-size: cover;
        -webkit-mask-position: center;
      }

      .hero .content {
        padding: 1.4rem 7%;
        /* max-width: 60rem; */
        width: 100%;
        text-align: center;
        position: fixed;
        top: 130px;
      }

      .hero .content h1 {
        font-size: 5rem;
        color: #fff;
        text-shadow: 1px 1px 3px rgba(1, 1, 3, 0.5);
        line-height: 1.2;
      }

      .hero .content h1 span {
        color: #46a9d3;
      }

      .hero .content h2 {
        font-size: 3rem;
        color: #fff;
        text-shadow: 1px 1px 3px rgba(1, 1, 3, 0.5);
        line-height: 1.2;
      }

      .hero .content h2 span {
        color: #46a9d3;
      }

      .hero .content p {
        font-size: 1.6rem;
        margin-top: 1rem;
        line-height: 1.4;
        font-weight: 100;
        text-shadow: 1px 1px 3px rgba(1, 1, 3, 0.5);
        mix-blend-mode: difference;
      }

      .hero .content .cta {
        margin-top: 1rem;
        display: inline-block;
        padding: 1rem 3rem;
        font-size: 1.4rem;
        color: #fff;
        background-color: #46a9d3;
        border-radius: 0.5rem;
        box-shadow: 1px 1px 3px rgba(1, 1, 3, 0.5);
      }
      body {
        padding-top: 90px;
        background-color: #ffffff;
      }

      .about-section {
        padding: 4rem 0;
      }
      .about-title {
        text-align: center;
        margin-bottom: 2rem;
        font-size: 2rem;
        font-weight: bold;
      }
      .about-content {
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .about-image {
        flex: 1;
        max-width: 400px;
        margin-right: 2rem;
      }
      .about-text {
        flex: 2;
        font-size: 1.25rem;
      }
      #produk {
        padding-top: 200px;
        padding-bottom: 60px;
      }
      #produk .card {
        border: none;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s;
      }
      #produk .card:hover {
        transform: scale(1.05);
      }
      #produk .card img {
        max-height: 200px;
        object-fit: cover;
      }
      #produk .card-body {
        text-align: center;
      }
      #tentang-kami {
        padding-top: 110px;
      }
      #kontak {
        padding-top: 90px;
      }
      .footer {
        background-color: #4dcaff;
        color: #ffffff;
        text-align: center;
      }
      .footer h5 {
        margin-bottom: 1rem;
        font-weight: bold;
      }
      .footer p {
        margin-bottom: 0.5rem;
      }
      .footer .bi {
        font-size: 1.5rem;
        margin: 0 0.75rem; /* Mengubah margin menjadi 0.75rem untuk jarak yang lebih rapi */
        transition: transform 0.3s;
      }
      .footer .bi:hover {
        transform: scale(1.2);
      }
      .footer .bi-instagram,
      .footer .bi-facebook,
      .footer .bi-email {
        color: #000000; /* Warna hitam untuk ikon */
      }
      .footer .bi-instagram:hover,
      .footer .bi-facebook:hover,
      .footer .bi-email:hover {
        color: #ffffff; /* Warna putih untuk ikon saat dihover */
      }

      .btn-primary {
        background-color: #4dcaff;
        border-color: #4dcaff;
      }
      .btn-primary:hover {
        background-color: #36b5ff;
        border-color: #36b5ff;
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg bg-white">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">
          <img src="../static/img/logo.png" alt="Logo" class="navbar-logo" />
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNavDropdown"
          aria-controls="navbarNavDropdown"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavDropdown">
          <ul class="navbar-nav mx-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="#home"
                >Beranda</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="#tentang-kami">Tentang Kami</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="#produk">Produk</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" href="#kontak">Kontak</a>
            </li>
          </ul>
          <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                id="profileIcon"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                <i class="bi bi-person-circle"></i>
              </a>
              <ul
                class="dropdown-menu dropdown-menu-end"
                aria-labelledby="profileIcon"
              >
                <li>
                  <a class="dropdown-item" href="{{ url_for('akun') }}"
                    >Akun saya</a
                  >
                </li>
                <li>
                  <a class="dropdown-item" href="{{ url_for('pesanan') }}"
                    >Pesanan saya</a
                  >
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li><a class="dropdown-item" onclick="logout()">Keluar</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Hero Section start -->
    <section class="hero" id="home">
      <div class="mask-container">
        <main class="content">
          <h1>Distributor Ikan <span>Tuna</span> dan <span>Cakalang</span></h1>
          <h2>Selamat datang, <span>{{ name_info.nama }}!</span></h2>
        </main>
      </div>
    </section>
    <!-- Hero Section end -->

    <!-- Tentang Kami Section -->
    <section id="tentang-kami" class="about-section py-5">
      <div class="container">
        <h2 class="text-center mb-5">Tentang Kami</h2>
        <div class="row">
          <!-- Poin 1: Apa itu UMKM Tampunganglawo -->
          <div class="col-12 col-md-6 mb-4">
            <div class="d-flex align-items-center mb-4">
              <i class="bi bi-cart fs-3 me-3 text-primary"></i>
              <div>
                <h4>Apa Itu UMKM Tampunganglawo?</h4>
                <p>
                  UMKM Tampunganglawo adalah sebuah usaha mikro, kecil, dan
                  menengah yang berlokasi di Bitung, Sulawesi Utara. Kami
                  bergerak dalam bidang penjualan dan distribusi ikan segar,
                  terutama cakalang dan tuna. Dengan dedikasi dan komitmen
                  tinggi, kami selalu memastikan bahwa setiap ikan yang kami
                  kirimkan adalah ikan yang berkualitas tinggi dan segar.
                </p>
              </div>
            </div>
          </div>

          <!-- Poin 2: Sumber Kualitas Ikan -->
          <div class="col-12 col-md-6 mb-4">
            <div class="d-flex align-items-center mb-4">
              <i class="bi bi-people fs-3 me-3 text-primary"></i>
              <div>
                <h4>Sumber Kualitas Ikan</h4>
                <p>
                  Kami mendapatkan ikan dari sumber-sumber terpercaya yang telah
                  melalui seleksi ketat untuk memastikan kualitas dan kesegaran.
                  Kami bekerja sama dengan nelayan lokal yang berpengalaman
                  untuk mendapatkan ikan segar dengan kualitas terbaik.
                </p>
              </div>
            </div>
          </div>

          <!-- Poin 3: Pengiriman Ikan -->
          <div class="col-12 col-md-6 mb-4">
            <div class="d-flex align-items-center mb-4">
              <i class="bi bi-truck fs-3 me-3 text-primary"></i>
              <div>
                <h4>Pengiriman Ikan</h4>
                <p>
                  Kami menyediakan layanan pengiriman ikan dengan memastikan
                  ikan tetap segar sampai ke tangan pelanggan. Kami melayani
                  pengiriman ke Manado dan sekitarnya dengan biaya ongkos kirim
                  sebesar Rp500.000 untuk maksimal 1.000 kg ikan.
                </p>
              </div>
            </div>
          </div>

          <!-- Poin 4: Cara Pemesanan -->
          <div class="col-12 col-md-6 mb-4">
            <div class="d-flex align-items-center mb-4">
              <i class="bi bi-envelope fs-3 me-3 text-primary"></i>
              <div>
                <h4>Cara Pemesanan</h4>
                <p>
                  Untuk melakukan pemesanan, Anda dapat menghubungi kami melalui
                  kontak yang tersedia di halaman ini. Minimal pemesanan adalah
                  100 kg ikan. Kami akan memproses pesanan Anda dan mengatur
                  pengiriman sesuai kebutuhan.
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Produk Section -->
    <section id="produk" class="py-5">
      <div class="container">
        <h2 class="text-center mb-5">Produk</h2>
        <div class="row">
          {% for product in products %}
          <div class="col-12 col-md-4 mb-4">
            <div class="card h-100">
              <img
                src="{{ url_for('static', filename='img/' + product['image']) }}"
                class="card-img-top"
                alt="{{ product['name'] }}"
                style="object-fit: cover; max-height: 200px"
              />
              <div class="card-body">
                <h5 class="card-title">{{ product['name'] }}</h5>
                <p class="card-text">Harga: Rp{{ product['price'] }}</p>
                <p class="card-text">Stok: {{ product['stock'] }} kg</p>
                <p class="card-text">{{ product['description'] }}</p>
                <a
                  href="javascript:void(0)"
                  class="btn btn-primary"
                  data-bs-toggle="modal"
                  data-bs-target="#purchaseModal"
                  data-name="{{ product['name'] }}"
                  data-price="{{ product['price'] }}"
                  data-stock="{{ product['stock'] }}"
                  data-image="{{ url_for('static', filename='img/' + product['image']) }}"
                >
                  Beli
                </a>

                <a
                  href="javascript:void(0)"
                  class="btn btn-secondary"
                  data-bs-toggle="modal"
                  data-bs-target="#detailModal"
                  data-name="{{ product['name'] }}"
                  data-price="Rp{{ product['price'] }}"
                  data-stock="{{ product['stock'] }} kg"
                  data-description="{{ product['description'] }}"
                >
                  Detail
                </a>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </section>

    <!-- Modal untuk Pembelian -->
    <div
      class="modal fade"
      id="purchaseModal"
      tabindex="-1"
      aria-labelledby="purchaseModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="purchaseModalLabel">Beli Produk</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form id="purchaseForm" action="/order" method="POST">
              <div class="mb-3">
                <label for="product-image" class="form-label"
                  >Gambar Produk</label
                >
                <img
                  id="product-image"
                  src=""
                  alt="Gambar Produk"
                  class="img-fluid"
                  style="max-width: 100%; height: auto"
                />
              </div>
              <div class="mb-3">
                <label for="product-name" class="form-label">Produk</label>
                <input
                  type="text"
                  class="form-control"
                  id="product-name"
                  name="product_name"
                  readonly
                />
              </div>
              <div class="mb-3">
                <label for="product-price" class="form-label"
                  >Harga per Kg</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="product-price"
                  name="product_price"
                  readonly
                />
              </div>
              <div class="mb-3">
                <label for="quantity" class="form-label">Jumlah (Kg)</label>
                <input
                  type="number"
                  class="form-control"
                  id="quantity"
                  name="quantity"
                  min="1"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="total-price" class="form-label">Total Harga</label>
                <input
                  type="text"
                  class="form-control"
                  id="total-price"
                  name="total_price"
                  readonly
                />
              </div>
              <input
                type="hidden"
                id="product-image-hidden"
                name="product_image"
              />
              <button type="submit" class="btn btn-primary">
                Beli Sekarang
              </button>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Batal
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Detail Modal -->
    <div
      class="modal fade"
      id="detailModal"
      tabindex="-1"
      aria-labelledby="detailModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="detailModalLabel">Detail Produk</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <h5 id="modalProductName"></h5>
            <p><strong>Harga:</strong> <span id="modalProductPrice"></span></p>
            <p><strong>Stok:</strong> <span id="modalProductStock"></span></p>
            <p id="modalProductDescription"></p>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Kontak Section -->
    <section id="kontak" class="py-5">
      <div class="container">
        <h2 class="text-center mb-5">Kontak</h2>
        <div class="row">
          <div class="col-12 col-md-6 mb-4">
            <!-- Google Maps Embed -->
            <iframe
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d989.2294341909065!2d125.19792898047768!3d1.4512176336460465!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x328701004b044e3f%3A0xb6bf75beedec76b3!2sTampunganglawo!5e0!3m2!1sid!2sid!4v1722745084995!5m2!1sid!2sid"
              width="100%"
              height="300"
              style="border: 0"
              allowfullscreen=""
              loading="lazy"
              referrerpolicy="no-referrer-when-downgrade"
            ></iframe>
          </div>
          <div class="col-12 col-md-6 mb-4">
            <!-- Contact Form -->
            <form
              id="contactForm"
              action="{{ url_for('submit_message_user') }}"
              method="POST"
              onsubmit="return handleSubmit()"
            >
              <div class="mb-3">
                <label for="name" class="form-label">Nama</label>
                <input
                  type="text"
                  class="form-control"
                  id="name"
                  name="name"
                  value="{{ name_info.nama }}"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="phone" class="form-label">No Telp</label>
                <input
                  type="tel"
                  class="form-control"
                  id="phone"
                  name="phone"
                  value="{{ name_info.nohp }}"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="message" class="form-label">Pesan</label>
                <textarea
                  class="form-control"
                  id="message"
                  name="message"
                  rows="5"
                  required
                ></textarea>
              </div>
              <button type="submit" class="btn btn-primary">Kirim</button>
            </form>
          </div>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="footer mt-5 py-4">
      <div class="container">
        <div class="row">
          <div class="col-12 col-md-4 mb-3">
            <h5>Kontak Kami</h5>
            <p>
              Alamat: Jl. Contoh No.123, Kota, Provinsi<br />
              Telepon: (123) 456-7890<br />
              Email: info@example.com
            </p>
          </div>
          <div class="col-12 col-md-4 mb-3">
            <h5>Tentang Kami</h5>
            <p>
              Kami adalah distributor ikan tuna dan cakalang yang berdedikasi
              untuk menyediakan produk berkualitas tinggi kepada pelanggan kami.
            </p>
          </div>
          <div class="col-12 col-md-4 mb-3">
            <h5>Ikuti Kami</h5>
            <a
              href="https://www.instagram.com/tampunganglawo?igsh=MXNkZzd2ZG9waXU3bg=="
              target="_blank"
              class="me-3"
            >
              <i class="bi bi-instagram"></i>
            </a>
            <a
              href="https://web.facebook.com/profile.php?id=61558268617422"
              target="_blank"
              class="me-3"
            >
              <i class="bi bi-facebook"></i>
            </a>
            <a
              href="mailto:lawotampungang@gmail.com"
              target="_blank"
              class="me-3"
            >
              <i class="bi bi-envelope bi-email"></i>
            </a>
          </div>
        </div>
        <div class="row mt-4">
          <div class="col-12 text-center">
            <p class="mb-0">
              &copy; 2024 Nama Perusahaan. All rights reserved.
            </p>
          </div>
        </div>
      </div>
    </footer>
  </body>

  <!-- Bootstrap JS Bundle with Popper -->
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"
  ></script>
  <!-- Include the Font Awesome JavaScript library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/js/all.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

  <!-- <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>  -->

  <!-- Bootstrap Core JavaScript -->
  <script src="bootstrap/dist/js/bootstrap.min.js"></script>
  <script>
    function handleSubmit() {
      // Tampilkan alert jika form berhasil dikirim
      alert("Pesan berhasil dikirim!");
      return true; // Biarkan form tetap terkirim
    }
  </script>
  <script>
    const menuIcon = document.getElementById("menu-icon");
    const menuList = document.getElementById("menu-list");

    menuIcon.addEventListener("click", () => {
      menuList.classList.toggle("hidden");
    });

    function logout() {
      $.removeCookie("mytoken", { path: "/" });
      alert("Keluar!");
      window.location.href = "/";
    }
  </script>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const notificationIcon = document.getElementById("notificationIcon");
      const cartIcon = document.getElementById("cartIcon");
      const profileIcon = document.getElementById("profileIcon");

      const notificationDropdown = document.getElementById(
        "notificationDropdown"
      );
      const cartDropdown = document.getElementById("cartDropdown");
      const profileDropdown = document.querySelector(
        ".dropdown-menu.dropdown-menu-end"
      );

      let notificationOpen = false;
      let cartOpen = false;
      let profileOpen = false;

      function closeAllDropdowns() {
        notificationDropdown.classList.remove("show");
        cartDropdown.classList.remove("show");
        profileDropdown.classList.remove("show");
        notificationOpen = false;
        cartOpen = false;
        profileOpen = false;
      }

      cartIcon.addEventListener("click", function (event) {
        event.preventDefault();
        if (cartOpen) {
          cartDropdown.classList.remove("show");
          cartOpen = false;
        } else {
          closeAllDropdowns();
          cartDropdown.classList.add("show");
          cartOpen = true;
        }
      });

      notificationIcon.addEventListener("click", function (event) {
        event.preventDefault();
        if (notificationOpen) {
          notificationDropdown.classList.remove("show");
          notificationOpen = false;
        } else {
          closeAllDropdowns();
          notificationDropdown.classList.add("show");
          notificationOpen = true;
        }
      });

      profileIcon.addEventListener("click", function (event) {
        event.preventDefault();
        if (profileOpen) {
          profileDropdown.classList.remove("show");
          profileOpen = false;
        } else {
          closeAllDropdowns();
          profileDropdown.classList.add("show");
          profileOpen = true;
        }
      });

      document.addEventListener("click", function (event) {
        if (
          !notificationIcon.contains(event.target) &&
          !notificationDropdown.contains(event.target) &&
          notificationOpen
        ) {
          notificationDropdown.classList.remove("show");
          notificationOpen = false;
        }
        if (
          !cartIcon.contains(event.target) &&
          !cartDropdown.contains(event.target) &&
          cartOpen
        ) {
          cartDropdown.classList.remove("show");
          cartOpen = false;
        }
        if (
          !profileIcon.contains(event.target) &&
          !profileDropdown.contains(event.target) &&
          profileOpen
        ) {
          profileDropdown.classList.remove("show");
          profileOpen = false;
        }
      });
    });
  </script>
  <script>
    $(document).ready(function () {
      $(".remove-btn").on("click", function () {
        const itemId = $(this).data("product-id"); // Mengambil ID produk dari data-product-id
        console.log("Menghapus item dengan ID:", itemId);

        $.ajax({
          url: `/remove_from_cart/${itemId}`,
          type: "POST",
          success: function (response) {
            console.log("Respons dari server:", response);
            if (response.status === "success") {
              alert("Pesanan berhasil dihapus");
              location.reload(); // Muat ulang halaman untuk memperbarui keranjang
            } else {
              alert(response.message);
            }
          },
          error: function (jqXHR, textStatus, errorThrown) {
            console.log("AJAX Error: ", textStatus, errorThrown);
            alert("Terjadi kesalahan saat menghapus item.");
          },
        });
      });
    });
  </script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const cartItemsContainer = document.getElementById("cartItems");

      // Menghapus item dari keranjang
      cartItemsContainer.addEventListener("click", function (event) {
        if (event.target.classList.contains("remove-item")) {
          const itemId = event.target.getAttribute("data-product-id");

          // Mengirim permintaan POST untuk menghapus item
          fetch(`/remove_from_cart/${itemId}`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.status === "success") {
                // Hapus item dari DOM
                const itemElement = document.getElementById(
                  `cart-item-${itemId}`
                );
                itemElement.remove();

                // Perbarui tampilan keranjang jika kosong
                if (cartItemsContainer.children.length === 0) {
                  cartItemsContainer.innerHTML = "<p>Your cart is empty</p>";
                }
              } else {
                console.error(data.message);
              }
            })
            .catch((error) => {
              console.error("Error:", error);
            });
        }
      });

      // Menambahkan item ke dalam keranjang secara dinamis
      function addToCart(productName, quantity, price, itemId, imageUrl) {
        const totalPrice = parseFloat(price) * quantity;
        const newItem = document.createElement("div");
        newItem.classList.add("cart-item");
        newItem.setAttribute("id", `cart-item-${itemId}`);
        newItem.innerHTML = `
              <img src="${imageUrl}" alt="${productName}" class="cart-item-image" />
              <div class="cart-item-details ms-3">
                  <p><strong>${productName}</strong></p>
                  <p>Jumlah: ${quantity} kg</p>
                  <p>Total Harga: Rp${totalPrice.toLocaleString()}</p>
              </div>
              <button class="btn btn-danger btn-sm remove-item" data-product-id="${itemId}">Hapus</button>
              <hr />
          `;
        cartItemsContainer.appendChild(newItem);
      }

      // Ketika tombol beli di modal diklik
      document
        .getElementById("buyButton")
        .addEventListener("click", function () {
          const productName = document.getElementById("productName").innerText;
          const quantity = parseInt(
            document.getElementById("quantityInput").value
          );
          const price = document
            .getElementById("price")
            .innerText.replace("Rp", "")
            .replace(/\./g, "");
          const imageUrl = document
            .getElementById("productImage")
            .getAttribute("src");
          const itemId = new Date().getTime().toString();

          fetch("/add_to_cart", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              product_name: productName,
              quantity: quantity,
              price: price,
              image_url: imageUrl, // Mengirim URL gambar produk
            }),
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.status === "success") {
                addToCart(
                  data.product_name,
                  data.quantity,
                  data.price,
                  data.item_id,
                  data.image_url
                );
                alert("Item berhasil ditambahkan ke keranjang");
                document.getElementById("buyModal").style.display = "none";
              } else {
                console.error(data.message);
              }
            })
            .catch((error) => {
              console.error("Error:", error);
            });
        });
    });
  </script>

  <script>
    function addToCart(productName, productPrice) {
      $.ajax({
        url: "/add_to_cart",
        method: "POST",
        contentType: "application/json",
        data: JSON.stringify({
          product_name: productName,
          quantity: 1, // Contoh quantity
          price: productPrice,
        }),
        success: function (response) {
          if (response.status === "success") {
            alert("Produk berhasil ditambahkan ke keranjang!");
            location.reload(); // Reload halaman untuk memperbarui cart
          } else {
            alert(response.message);
          }
        },
        error: function () {
          alert("Terjadi kesalahan saat menambahkan produk ke keranjang.");
        },
      });
    }
  </script>

  <script>
    // Event listener untuk menampilkan modal dan mengisi data produk
    const purchaseModal = document.getElementById("purchaseModal");
    const productName = document.getElementById("product-name");
    const productPrice = document.getElementById("product-price");
    const quantity = document.getElementById("quantity");
    const totalPrice = document.getElementById("total-price");
    const productImage = document.getElementById("product-image");
    const hiddenProductImage = document.getElementById("product-image-hidden");

    // Fungsi untuk menampilkan detail produk di modal pembelian
    purchaseModal.addEventListener("show.bs.modal", function (event) {
      const button = event.relatedTarget;
      const name = button.getAttribute("data-name");
      const price = button
        .getAttribute("data-price")
        .replace("Rp", "")
        .replace(/\./g, "");
      const image = button.getAttribute("data-image");
      const stock = parseInt(button.getAttribute("data-stock")); // Mengambil stok produk

      // Set data produk di modal
      productName.value = name;
      productPrice.value = `Rp ${new Intl.NumberFormat("id-ID").format(
        parseFloat(price)
      )}`;
      productImage.src = image;
      hiddenProductImage.value = image;

      // Reset form quantity dan total price saat modal dibuka
      quantity.value = "";
      totalPrice.value = "";

      // Set batas maksimum input quantity sesuai stok produk
      quantity.max = stock;

      // Event listener untuk menghitung total harga dan validasi jumlah
      quantity.addEventListener("input", function () {
        let kg = parseFloat(quantity.value) || 0;

        // Selalu naik dalam kelipatan 100
        if (kg < 100) {
          kg = 100; // Set minimum ke 100
        } else {
          kg = Math.ceil(kg / 100) * 100; // Naikkan ke kelipatan 100 terdekat
        }

        // Update input quantity dengan nilai kelipatan 100
        quantity.value = kg;

        // Validasi stok
        if (kg > stock) {
          totalPrice.value = `Jumlah melebihi stok yang tersedia (${stock} kg)`;
        } else {
          const total = kg * parseFloat(price.replace(/,/g, ""));
          totalPrice.value = `Rp ${new Intl.NumberFormat("id-ID").format(
            total
          )}`;
        }
      });
    });
  </script>

  <script>
    // Fungsi untuk memformat angka dengan locale Indonesia
    function formatRupiah(value) {
      return new Intl.NumberFormat("id-ID", {
        style: "currency",
        currency: "IDR",
        minimumFractionDigits: 0, // Menghapus pecahan desimal jika tidak diperlukan
      })
        .format(value)
        .replace("Rp ", ""); // Menghapus 'Rp ' dari format
    }

    // Mengupdate total harga produk di keranjang
    function updateCartPrices() {
      var totalPriceElement = document.getElementById("totalSelectedPrice");
      var totalPrice = 0;

      document.querySelectorAll(".cart-item-price").forEach(function (element) {
        var priceText = element.textContent
          .replace("Total Harga: Rp", "")
          .replace(/\./g, "") // Menghapus format ribuan yang ada
          .replace(/,/g, "."); // Mengganti koma dengan titik untuk parsing angka
        totalPrice += parseFloat(priceText);
      });

      // Update total harga dengan format Rupiah
      totalPriceElement.textContent = `Rp ${formatRupiah(totalPrice)}`;
    }

    // Event listener untuk update cart prices
    document.addEventListener("DOMContentLoaded", function () {
      updateCartPrices();

      // Menghitung total harga untuk semua produk di keranjang
      const totalSelectedPrice = document.getElementById("totalSelectedPrice");
      const cartItems = document.querySelectorAll(".cart-item");

      function updateTotalPrice() {
        let total = 0;
        cartItems.forEach((item) => {
          const priceText = item
            .querySelector(".cart-item-price")
            .innerText.replace("Total Harga: Rp", "")
            .replace(/\./g, "")
            .replace(/,/g, ".");
          total += parseFloat(priceText);
        });
        totalSelectedPrice.textContent = `Rp ${total.toLocaleString("id-ID", {
          minimumFractionDigits: 0,
        })}`;
      }

      // Update total price on page load
      updateTotalPrice();

      // Event listener untuk tombol "Buat Pesanan"
      document
        .getElementById("placeOrderButton")
        .addEventListener("click", function () {
          const selectedItems = [];
          cartItems.forEach((item) => {
            const productName = item
              .querySelector(".cart-item-name")
              .innerText.trim();
            const quantity = item
              .querySelector(".cart-item-quantity")
              .innerText.replace("Jumlah: ", "")
              .trim();
            const totalPrice = parseFloat(
              item
                .querySelector(".cart-item-price")
                .innerText.replace("Total Harga: Rp", "")
                .replace(/\./g, "")
                .replace(/,/g, ".")
            ).toFixed(2); // Pastikan ini adalah angka
            const imageUrl = item.querySelector("img").src; // Ambil URL gambar
            selectedItems.push({
              product_name: productName,
              quantity,
              total_price: totalPrice,
              image_url: imageUrl, // Tambahkan URL gambar
            });
          });

          if (selectedItems.length > 0) {
            fetch("/place_order", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ selected_items: selectedItems }),
            })
              .then((response) => response.json())
              .then((data) => {
                if (data.status === "success") {
                  window.location.href = "/order"; // Redirect to order page
                } else {
                  alert(data.message);
                }
              })
              .catch((error) => {
                console.error("Error:", error);
                alert("Terjadi kesalahan saat memproses pesanan.");
              });
          } else {
            alert("Keranjang kosong. Tidak ada produk untuk diproses.");
          }
        });

      // Event listener untuk update cart items
      function updateCartItems(cartItems) {
        const cartItemsContainer = document.getElementById("cartItems");
        // Clear current cart content
        cartItemsContainer.innerHTML = "";

        // If there are items in the cart, add them
        if (cartItems && cartItems.length > 0) {
          cartItems.forEach((item) => {
            const cartItemDiv = document.createElement("div");
            cartItemDiv.classList.add("cart-item");

            cartItemDiv.innerHTML = `
                <div class="d-flex align-items-center">
                  <img src="${
                    item.image_url || "https://via.placeholder.com/50"
                  }" alt="${item.product_name}" class="cart-item-image" />
                  <div class="cart-item-details ms-3">
                    <p class="cart-item-name"><strong>${
                      item.product_name
                    }</strong></p>
                    <p class="cart-item-quantity">Jumlah: ${
                      item.quantity
                    } kg</p>
                    <p class="cart-item-price">Total Harga: Rp ${new Intl.NumberFormat(
                      "id-ID"
                    ).format(item.total_price)}</p>
                  </div>
                  <button class="btn btn-sm btn-danger ms-auto remove-btn" data-product-id="${
                    item._id
                  }">
                    <i class="bi bi-trash"></i>
                  </button>
                </div>
                <hr />
              `;

            cartItemsContainer.appendChild(cartItemDiv);
          });
        } else {
          cartItemsContainer.innerHTML = "<p>Keranjang kosong</p>";
        }
      }

      // Event listener untuk pengiriman form pembelian

      purchaseForm.addEventListener("submit", function (event) {
        event.preventDefault();

        const formData = {
          product_name: productName.value,
          quantity: quantity.value,
          price: productPrice.value.replace("Rp", "").replace(/\./g, ""), // Remove commas
          image_url: productImage.src, // Tambahkan URL gambar
        };

        fetch("/add_to_cart", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(formData),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.status === "success") {
              alert("Produk berhasil ditambahkan");

              // Tutup modal setelah berhasil menambahkan
              $("#purchaseModal").modal("hide");

              // Muat ulang halaman untuk mencerminkan perubahan di keranjang
              window.location.reload(); // Reload the page
            } else {
              alert(data.message);
            }
          })
          .catch((error) => {
            console.error("Error:", error);
            alert("Terjadi kesalahan saat menambahkan produk ke keranjang.");
          });
      });
    });

    // Fungsi untuk menampilkan dropdown notifikasi dan keranjang
    document
      .getElementById("notificationIcon")
      .addEventListener("click", function () {
        document
          .getElementById("notificationDropdown")
          .classList.toggle("show");
      });

    document.getElementById("cartIcon").addEventListener("click", function () {
      document.getElementById("cartDropdown").classList.toggle("show");
    });
  </script>

  <script>
    var detailModal = document.getElementById("detailModal");
    detailModal.addEventListener("show.bs.modal", function (event) {
      var button = event.relatedTarget;
      var name = button.getAttribute("data-name");
      var price = button.getAttribute("data-price");
      var stock = button.getAttribute("data-stock");
      var description = button.getAttribute("data-description");

      var modalTitle = detailModal.querySelector(".modal-title");
      var modalProductName = detailModal.querySelector("#modalProductName");
      var modalProductPrice = detailModal.querySelector("#modalProductPrice");
      var modalProductStock = detailModal.querySelector("#modalProductStock");
      var modalProductDescription = detailModal.querySelector(
        "#modalProductDescription"
      );

      modalTitle.textContent = "Detail Produk - " + name;
      modalProductName.textContent = name;
      modalProductPrice.textContent = price;
      modalProductStock.textContent = stock;
      modalProductDescription.textContent = description;
    });
  </script>
</html>
